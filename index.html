<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Chat with PeerJS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        #chat-container {
            width: 400px;
            height: 600px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        #messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            border-bottom: 1px solid #ddd;
        }
        #messages div {
            margin: 5px 0;
        }
        #message-input {
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        #message-input input {
            padding: 10px;
            margin-bottom: 5px;
            border: 1px solid #ddd;
        }
        #message-input button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        #message-input button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="messages"></div>
    <div id="message-input">
        <input type="text" id="username" placeholder="Enter your name..." />
        <input type="text" id="message" placeholder="Type your message..." />
        <input type="file" id="fileInput" />
        <button id="send">Send</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.0/dist/peerjs.min.js"></script>
<script>
    const peer = new Peer();
    let conn;

    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("message");
    const usernameInput = document.getElementById("username");
    const sendButton = document.getElementById("send");
    const fileInput = document.getElementById("fileInput");

    const MAX_FILE_SIZE_MB = 5; // 5 MB max file size
    const CURSE_WORDS = ["badword1", "badword2"]; // Add more as needed

    peer.on('open', (id) => {
        alert(`Your peer ID is: ${id}. Share it with your friend.`);
    });

    // Handle receiving messages and files
    peer.on('connection', (dataConnection) => {
        conn = dataConnection;
        conn.on('data', (data) => {
            if (data.type === 'message') {
                addMessage(data.username, data.text);
            } else if (data.type === 'file') {
                receiveFile(data.file, data.filename);
            }
        });
    });

    // Add message to chat
    function addMessage(sender, message) {
        const messageDiv = document.createElement("div");
        messageDiv.textContent = `${sender}: ${filterCurseWords(message)}`;
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll
    }

    // Filter out curse words
    function filterCurseWords(message) {
        let filteredMessage = message;
        CURSE_WORDS.forEach(word => {
            const regex = new RegExp(`\\b${word}\\b`, 'gi');
            filteredMessage = filteredMessage.replace(regex, '****');
        });
        return filteredMessage;
    }

    // Handle sending messages
    sendButton.onclick = () => {
        const username = usernameInput.value || "Anonymous";
        const message = messageInput.value;

        if (message) {
            conn.send({ type: 'message', username, text: message });
            addMessage("You", message);
            messageInput.value = ""; // Clear input
        }

        // Handle sending files
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            if (file.size <= MAX_FILE_SIZE_MB * 1024 * 1024) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    conn.send({ type: 'file', file: event.target.result, filename: file.name });
                    addMessage("You", `Sent file: ${file.name}`);
                };
                reader.readAsDataURL(file);
            } else {
                alert("File is too big! Max size is 5MB.");
            }
            fileInput.value = ""; // Clear file input
        }
    };

    // Receive file
    function receiveFile(fileData, filename) {
        const link = document.createElement("a");
        link.href = fileData;
        link.download = filename;
        link.textContent = `Download file: ${filename}`;
        messagesDiv.appendChild(link);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll
    }

    // Connect to a peer
    const peerID = prompt("Enter peer ID to connect:");
    if (peerID) {
        conn = peer.connect(peerID);
        conn.on('open', () => {
            addMessage("System", "Connected to peer.");
        });
    }
</script>

</body>
</html>
